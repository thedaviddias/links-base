echo 'ğŸš€ Starting pre-commit checks...'
echo 'â³ This might take a moment, making sure everything is perfect!'

# Check package versions
echo "ğŸ“¦ Checking package versions consistency..."
pnpx syncpack list-mismatches || (
    echo 'âŒ Package version check failed. Run pnpm syncpack:fix to resolve.'
    false;
)

# Check ESLint Standards
echo "ğŸ” Running code quality checks..."
pnpm lint || (
    echo 'âŒ Code quality checks failed!
    ğŸ‘‰ Run pnpm format:all to fix formatting and linting issues'
    false;
)

echo 'âœ¨ Code quality checks passed!'

# Run lint-staged only in workspaces that have it configured
echo "ğŸ¯ Running final checks in each workspace..."
found_lint_staged=false

for pkg in apps/* packages/*; do
    if [ -f "$pkg/package.json" ] && grep -q '"lint-staged":' "$pkg/package.json"; then
        found_lint_staged=true
        echo "ğŸ“ Processing $pkg..."
        (cd "$pkg" && pnpm exec lint-staged) || exit 1
    fi
done

if [ "$found_lint_staged" = false ]; then
    echo "â„¹ï¸  No workspace-specific checks needed"
fi

echo "ğŸ‰ All checks passed - Your code is ready to commit! ğŸŒŸ"
